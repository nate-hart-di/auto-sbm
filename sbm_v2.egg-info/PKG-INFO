Metadata-Version: 2.4
Name: sbm-v2
Version: 2.4.0
Summary: Site Builder Migration Tool V2 - Team-friendly, Context7-powered migration tool for DealerInspire dealer websites
Author: DealerInspire Development Team
License: MIT
Project-URL: Homepage, https://github.com/dealerinspire/sbm-v2
Project-URL: Repository, https://github.com/dealerinspire/sbm-v2
Project-URL: Documentation, https://github.com/dealerinspire/sbm-v2/docs
Project-URL: Bug Tracker, https://github.com/dealerinspire/sbm-v2/issues
Keywords: dealerinspire,migration,scss,context7,stellantis
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: click>=8.0.0
Requires-Dist: rich>=13.0.0
Requires-Dist: gitpython>=3.1.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: requests>=2.28.0
Requires-Dist: mcp>=0.1.0
Requires-Dist: pathlib2>=2.3.0
Requires-Dist: colorama>=0.4.0
Requires-Dist: jinja2>=3.0.0
Requires-Dist: python-dotenv>=1.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=5.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: pre-commit>=2.20.0; extra == "dev"

# SBM Tool V2 - Site Builder Migration Tool

Team-friendly, Context7-powered migration tool for DealerInspire dealer websites. Optimized for Stellantis dealers with enhanced SCSS processing capabilities.

## 🚀 Quick Start

### Prerequisites

- Python 3.8+
- Git access to DI Websites Platform repository
- `just` command (justfile) installed
- Context7 MCP server (optional but recommended)

### Installation

1. **Clone and setup:**

   ```bash
   cd /Users/nathanhart/Desktop/projects/automation/sbm-v2
   pip install -e .
   ```

2. **Configure environment:**

   ```bash
   cp env.example .env
   # Edit .env with your settings
   ```

3. **Verify installation:**
   ```bash
   sbm doctor
   ```

### Basic Usage

```bash
# Migrate a Stellantis dealer
sbm migrate chryslerofportland

# Check migration status
sbm status chryslerofportland

# Validate results
sbm validate chryslerofportland

# Show configuration
sbm config-info
```

## 📋 Features

### ✅ Core Functionality

- **Git Operations**: Automated branch creation, commits, and PR generation
- **Site Initialization**: `just start {slug} prod` integration
- **Site Builder Files**: Creates `sb-inside.scss`, `sb-vdp.scss`, `sb-vrp.scss`, `sb-home.scss`
- **Style Migration**: SCSS-to-CSS transformation with Context7 integration
- **Map Components**: Automated map component migration
- **Validation**: Comprehensive SCSS and theme validation

### 🚗 Stellantis Enhancement

- **Brand Detection**: Automatic detection of Chrysler, Dodge, Jeep, Ram, Fiat, CDJR
- **Enhanced Processing**: Stellantis-specific style patterns and transformations
- **Map Integration**: Stellantis-branded map components and direction boxes
- **Demo Optimization**: Sub-5-minute migration for live demonstrations

### 🔗 Context7 Integration

- **Modern SCSS Processing**: Leverages Context7 MCP server for advanced transformations
- **Variable Conversion**: `$primary` → `var(--primary)`
- **Mixin Replacement**: `@include flexbox()` → `display: flex`
- **Path Conversion**: Relative to absolute WordPress paths
- **Fallback Support**: Graceful degradation when Context7 unavailable

### 👥 Team-Friendly Features

- **One-Command Setup**: Simple installation and configuration
- **Rich Console Output**: Beautiful progress indicators and status displays
- **Comprehensive Logging**: Detailed logs with helpful error suggestions
- **Demo Mode**: Special mode for live presentations
- **Diagnostic Tools**: Built-in health checks and troubleshooting

## 🛠 Commands

### Migration Commands

```bash
# Basic migration
sbm migrate <slug>

# Force reset existing files
sbm migrate <slug> --force

# Skip Git operations
sbm migrate <slug> --skip-git

# Dry run (show what would be done)
sbm migrate <slug> --dry-run
```

### Validation Commands

```bash
# Full validation
sbm validate <slug>

# SCSS-only validation
sbm validate <slug> --scss-only

# Attempt auto-fix
sbm validate <slug> --fix
```

### Status and Diagnostics

```bash
# Check theme status
sbm status <slug>

# Show configuration
sbm config-info

# Run diagnostics
sbm doctor

# List available themes
sbm doctor --list-themes

# Test Context7 connection
sbm doctor --check-context7
```

## ⚙️ Configuration

### Environment Variables

Copy `env.example` to `.env` and configure:

```bash
# Required
DI_PLATFORM_DIR=/Users/nathanhart/external-sync-repo

# Context7 Integration
CONTEXT7_SERVER_URL=http://localhost:3001
CONTEXT7_API_KEY=your_api_key_here

# Git Configuration
GIT_USER_NAME=Your Name
GIT_USER_EMAIL=your.email@dealerinspire.com

# GitHub Integration
GITHUB_TOKEN=your_github_token
GITHUB_ORG=carsdotcom
GITHUB_REPO=di-websites-platform

# Demo Mode
DEMO_MODE=false
DEMO_TIMEOUT=300

# Stellantis Enhancement
STELLANTIS_ENHANCED_MODE=true
STELLANTIS_BRAND_DETECTION=auto
```

### Stellantis Brand Patterns

The tool automatically detects these Stellantis brands:

- **Chrysler**: `chrysler`, `chryslerof`, `chrysler-`
- **Dodge**: `dodge`, `dodgeof`, `dodge-`
- **Jeep**: `jeep`, `jeepof`, `jeep-`
- **Ram**: `ram`, `ramof`, `ram-`, `ramtrucks`
- **Fiat**: `fiat`, `fiatof`, `fiat-`
- **CDJR**: `cdjr`, `cdjrof`, `chryslerdodgejeepram`
- **FCA**: `fca`, `fcaof`, `fiat-chrysler`

## 🎯 Demo Mode

For live demonstrations, enable demo mode:

```bash
export DEMO_MODE=true
export DEMO_TIMEOUT=300
export DEMO_SKIP_STARTUP=true # Skip site initialization for speed
```

Demo mode features:

- Enhanced progress indicators
- Optimized for sub-5-minute migrations
- Special demo banner
- Reduced timeouts
- Optional step skipping

## 🔧 Development

### Project Structure

```
sbm-v2/
├── sbm/                        # Main package
│   ├── cli.py                  # Command line interface
│   ├── config.py               # Configuration management
│   ├── core/                   # Core functionality
│   │   ├── migration.py        # Migration orchestration
│   │   ├── workflow.py         # Full workflow coordination
│   │   ├── git.py              # Git operations
│   │   ├── validation.py       # Theme validation
│   │   └── maps.py             # Map component handling
│   ├── scss/                   # SCSS processing
│   │   ├── transformer.py      # SCSS transformations
│   │   ├── parser.py           # Style extraction
│   │   ├── validator.py        # SCSS validation
│   │   └── context7.py         # Context7 integration
│   ├── oem/                    # OEM handlers
│   │   ├── factory.py          # OEM detection
│   │   ├── base.py             # Base handler
│   │   ├── stellantis.py       # Enhanced Stellantis handler
│   │   └── default.py          # Default handler
│   └── utils/                  # Utilities
│       ├── logger.py           # Enhanced logging
│       └── errors.py           # Error handling
├── tests/                      # Test suite
├── archived/                   # Reference materials
└── docs/                       # Documentation
```

### Running Tests

```bash
# Install development dependencies
pip install -e ".[dev]"

# Run tests
pytest

# Run with coverage
pytest --cov=sbm
```

### Code Quality

```bash
# Format code
black sbm/

# Lint code
flake8 sbm/

# Type checking
mypy sbm/
```

## 📚 Reference Materials

The `archived/reference-sbm/` directory contains working components from the original implementation:

- **Core Logic**: Migration orchestration and workflow
- **SCSS Processing**: Transformation and parsing logic
- **OEM Handling**: Brand detection and processing
- **Git Operations**: Branch creation and commit logic
- **Validation**: Theme and SCSS validation

## 🐛 Troubleshooting

### Common Issues

**Configuration Error:**

```bash
sbm doctor # Check configuration
```

**Context7 Connection Issues:**

```bash
sbm doctor --check-context7 # Test connection
export SKIP_CONTEXT7=true   # Disable if needed
```

**Git Repository Issues:**

```bash
sbm doctor --check-git # Check Git status
git status             # Manual check
```

**Theme Not Found:**

```bash
sbm doctor --list-themes # List available themes
```

### Error Recovery

The tool provides helpful error messages with suggestions:

- **Missing environment variables**: Copy `env.example` to `.env`
- **Git conflicts**: Clean repository state required
- **SCSS errors**: Detailed syntax error reporting
- **Context7 issues**: Automatic fallback to local processing

## 🤝 Contributing

1. Follow the existing code structure and patterns
2. Add tests for new functionality
3. Update documentation for changes
4. Use the existing error handling patterns
5. Maintain Context7 integration compatibility

## 📄 License

MIT License - see LICENSE file for details.

## 🔗 Related Projects

- **Original SBM Tool**: `/Users/nathanhart/auto-sbm/`
- **DI Websites Platform**: Main repository for dealer themes
- **Context7 MCP**: Modern SCSS processing server

---

**SBM Tool V2** - Built for the DealerInspire team with ❤️
